---
const CLICKUP_API_TOKEN = import.meta.env.CLICKUP_API_TOKEN;
const LIST_ID = '901519788009';

const iconMap: Record<string, { icon: string; color: string }> = {
  'üèÉ': { icon: 'activity', color: 'emerald' },
  'üí¨': { icon: 'message-circle', color: 'blue' },
  'üìä': { icon: 'bar-chart-3', color: 'violet' },
  'üìã': { icon: 'layout-grid', color: 'blue' },
  'ü•ó': { icon: 'utensils', color: 'emerald' },
  'üß†': { icon: 'brain', color: 'rose' },
  'üèÜ': { icon: 'trophy', color: 'amber' },
  '‚òÄÔ∏è': { icon: 'sun', color: 'amber' },
  'üèãÔ∏è': { icon: 'dumbbell', color: 'violet' },
  'üì∏': { icon: 'camera', color: 'cyan' },
  'ü§ñ': { icon: 'sparkles', color: 'violet' },
  'üìö': { icon: 'book-open', color: 'blue' },
  'üîî': { icon: 'bell', color: 'amber' },
  'üìù': { icon: 'file-text', color: 'cyan' },
  '‚ö°': { icon: 'zap', color: 'amber' },
  'üßò': { icon: 'brain', color: 'cyan' },
  'üåê': { icon: 'globe', color: 'blue' },
  'üíä': { icon: 'pill', color: 'emerald' },
  'üò¥': { icon: 'moon', color: 'blue' },
  'üé§': { icon: 'mic', color: 'rose' },
  'üè≠': { icon: 'factory', color: 'amber' },
  'üìÖ': { icon: 'calendar', color: 'blue' },
  'üéÆ': { icon: 'gamepad', color: 'violet' },
};

function parseMarkdown(md: string): string {
  if (!md) return '<p class="text-white/40">Beschreibung folgt...</p>';
  
  return md
    .replace(/^### (.+)$/gm, '<h4 class="text-white/80 font-semibold text-sm mt-6 mb-2">$1</h4>')
    .replace(/^## (.+)$/gm, '<h3 class="text-white/90 font-semibold text-base mt-8 mb-3 pb-2 border-b border-white/[0.06]">$1</h3>')
    .replace(/^# (.+)$/gm, '<h2 class="text-white font-bold text-lg mt-8 mb-4">$1</h2>')
    .replace(/\*\*(.+?)\*\*/g, '<strong class="text-white/80 font-medium">$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/^- (.+)$/gm, '<li class="flex items-start gap-2 text-white/50"><span class="text-flieder-400 mt-1.5">‚Ä¢</span><span>$1</span></li>')
    .replace(/(<li.*<\/li>\n?)+/g, '<ul class="space-y-1.5 my-4">$&</ul>')
    .replace(/‚Üí/g, '<span class="text-flieder-400">‚Üí</span>')
    .split('\n\n')
    .map(block => {
      if (block.startsWith('<h') || block.startsWith('<ul')) return block;
      if (block.trim() === '') return '';
      return '<p class="text-white/50 leading-relaxed">' + block.replace(/\n/g, ' ') + '</p>';
    })
    .join('\n');
}

let features: any[] = [];
let error: string | null = null;

try {
  const res = await fetch('https://api.clickup.com/api/v2/list/' + LIST_ID + '/task?archived=false&include_markdown_description=true&include_closed=true', {
    headers: { 'Authorization': CLICKUP_API_TOKEN, 'Content-Type': 'application/json' }
  });
  const data = await res.json();
  if (!res.ok) throw new Error('ClickUp API Error: ' + res.status);

  features = data.tasks.map((task: any) => {
    const emoji = task.name.match(/^[\p{Emoji}]/u)?.[0] || '‚ú®';
    const iconData = iconMap[emoji] || { icon: 'star', color: 'violet' };
    
    let status: 'todo' | 'in_progress' | 'done' = 'todo';
    const taskStatus = task.status?.status?.toLowerCase() || '';
    if (taskStatus.includes('progress') || taskStatus.includes('arbeit')) status = 'in_progress';
    if (taskStatus.includes('done') || taskStatus.includes('complete') || taskStatus.includes('live')) status = 'done';
    
    const phaseMatch = task.name.match(/\(Phase \d+[^)]*\)/);
let phase = 'Geplant';
if (status === 'done') {
  phase = 'Live';
} else if (status === 'in_progress') {
  phase = phaseMatch ? phaseMatch[0].replace(/[()]/g, '') : 'In Arbeit';
} else if (phaseMatch) {
  phase = phaseMatch[0].replace(/[()]/g, '');
}
    const tags = task.tags?.map((t: any) => t.name) || [];
    const rawDescription = task.markdown_description || task.description || task.text_content || '';
    
    return {
      id: task.id,
      name: task.name.replace(/^[\p{Emoji}]\s*(EPIC:|FEATURE:)?\s*/u, '').replace(/\s*\([^)]+\)$/, ''),
      icon: iconData.icon, color: iconData.color, status, phase,
      tags: tags.length > 0 ? tags : ['App'],
      description: rawDescription,
      descriptionHtml: parseMarkdown(rawDescription),
    };
  });
} catch (e: any) { error = e.message; }

const tabs = [
  { id: 'done', label: 'Live', count: features.filter(f => f.status === 'done').length },
  { id: 'in_progress', label: 'In Arbeit', count: features.filter(f => f.status === 'in_progress').length },
  { id: 'todo', label: 'Geplant', count: features.filter(f => f.status === 'todo').length },
];

const WHATSAPP = '491624077947';
const EMAIL = 'dominik@unique-coaching.com';

const icons: Record<string, string> = {
  'brain': '<path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/>',
  'sparkles': '<path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/><path d="M20 3v4"/><path d="M22 5h-4"/><path d="M4 17v2"/><path d="M5 18H3"/>',
  'activity': '<path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/>',
  'layout-grid': '<rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/>',
  'message-circle': '<path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/>',
  'bar-chart-3': '<path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/>',
  'utensils': '<path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>',
  'trophy': '<path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>',
  'sun': '<circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/>',
  'dumbbell': '<path d="M14.4 14.4 9.6 9.6"/><path d="M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z"/><path d="m21.5 21.5-1.4-1.4"/><path d="M3.9 3.9 2.5 2.5"/><path d="M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z"/>',
  'camera': '<path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/>',
  'book-open': '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>',
  'bell': '<path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>',
  'file-text': '<path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/>',
  'zap': '<path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/>',
  'globe': '<circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/>',
  'star': '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>',
  'chevron-right': '<path d="m9 18 6-6-6-6"/>',
  'mail': '<rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>',
  'pill': '<path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/><path d="m8.5 8.5 7 7"/>',
  'moon': '<path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>',
  'mic': '<path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/>',
  'factory': '<path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M17 18h1"/><path d="M12 18h1"/><path d="M7 18h1"/>',
  'calendar': '<path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/>',
  'gamepad': '<line x1="6" x2="10" y1="12" y2="12"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="15" x2="15.01" y1="13" y2="13"/><line x1="18" x2="18.01" y1="11" y2="11"/><rect width="20" height="12" x="2" y="6" rx="2"/>',
};
---

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>What's Next ¬∑ UNIQUE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#0a0a0b">
</head>

<body class="bg-bg min-h-screen text-white antialiased selection:bg-flieder-500/30">
  <div class="fixed inset-0 pointer-events-none">
    <div class="absolute inset-0 opacity-[0.015]" style="background-image: url('data:image/svg+xml,%3Csvg viewBox=%220 0 256 256%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noise%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.8%22 numOctaves=%224%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noise)%22/%3E%3C/svg%3E');"></div>
    <div class="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] rounded-full bg-flieder-600/[0.07] blur-[120px]"></div>
    <div class="absolute bottom-[-10%] left-[-10%] w-[500px] h-[500px] rounded-full bg-accent-blue/[0.05] blur-[100px]"></div>
  </div>

  <div class="relative z-10 max-w-lg mx-auto px-6 py-12 sm:py-16">
    <header class="mb-12 animate-fade-in">
      <div class="flex justify-center mb-8">
        <div class="relative group">
          <div class="absolute inset-0 bg-flieder-500/20 rounded-3xl blur-2xl group-hover:bg-flieder-500/30 transition-colors duration-500"></div>
          <img src="/logo.svg" alt="UNIQUE Coaching" class="relative w-32 h-32 sm:w-40 sm:h-40 object-contain" />
        </div>
      </div>
      <div class="text-center space-y-3">
        <h1 class="text-4xl sm:text-5xl font-bold tracking-tighter bg-gradient-to-r from-white via-flieder-300 to-flieder-400 bg-clip-text text-transparent">What's Next</h1>
        <p class="text-white/50 text-sm sm:text-base">Dein Feedback formt die App</p>
      </div>
    </header>

    {error && (<div class="mb-8 p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm">Fehler beim Laden: {error}</div>)}

    <nav class="mb-8 animate-fade-in" style="animation-delay: 100ms;">
      <div class="flex gap-1.5 p-1 bg-white/[0.02] rounded-xl border border-white/[0.04]">
        {tabs.map((tab, i) => (
          <button class={`tab group relative flex-1 py-2.5 px-3 rounded-lg text-xs sm:text-sm font-medium transition-all duration-300 ${i === 0 ? 'active' : ''}`} data-tab={tab.id}>
            <span class="relative z-10 tab-label">{tab.label}</span>
            <span class="relative z-10 tab-count font-mono text-[10px] sm:text-xs ml-1.5 opacity-50">{tab.count}</span>
            <div class="tab-bg absolute inset-0 rounded-lg bg-white/[0.06] opacity-0 transition-opacity duration-300"></div>
          </button>
        ))}
      </div>
    </nav>

    <div class="flex items-center justify-center gap-2 mb-6 animate-fade-in" style="animation-delay: 150ms;">
      <span class="text-[10px] text-white/30 font-mono uppercase tracking-wider">{features.length} Features insgesamt</span>
    </div>

    <div class="space-y-3" id="cards">
      {features.filter(f => f.status === 'done').map((feature, i) => (
        <article data-status={feature.status} data-feature={JSON.stringify({...feature, descriptionHtml: feature.descriptionHtml})} class="card-wrapper animate-slide-up" style={`animation-delay: ${150 + i * 60}ms;`}>
          <div class={`card card--${feature.color} group`} data-id={feature.id}>
            <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/[0.08] to-transparent"></div>
            <div class="flex items-start gap-4">
              <div class={`icon-box icon-box--${feature.color}`}>
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" set:html={icons[feature.icon] || icons['star']} />
              </div>
              <div class="flex-1 min-w-0 space-y-2">
                <h3 class="text-[15px] font-semibold text-white/90 leading-snug tracking-tight pr-6">{feature.name}</h3>
                <div class="flex flex-wrap items-center gap-1.5">
                  <span class="tag tag--phase font-mono uppercase tracking-wider">{feature.phase}</span>
                  {feature.tags.slice(0, 2).map((tag: string) => (<span class="tag tag--default">{tag}</span>))}
                </div>
              </div>
              <div class="flex-shrink-0 self-center">
                <svg class="w-4 h-4 text-white/20 group-hover:text-white/40 transition-all" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" set:html={icons['chevron-right']} />
              </div>
            </div>
            <div class={`card-glow card-glow--${feature.color}`}></div>
          </div>
        </article>
      ))}
    </div>

    <div id="empty-state" class="hidden py-16 text-center">
      <p class="text-white/30 text-sm">Keine Features in dieser Kategorie</p>
    </div>

    <footer class="mt-16 pt-6 border-t border-white/[0.04]">
      <div class="flex items-center justify-between">
        <p class="text-[10px] text-white/20 font-mono uppercase tracking-wider">¬© 2026 Unique</p>
        <div class="flex items-center gap-1.5">
          <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
          <span class="text-[10px] text-white/30 font-mono">Live</span>
        </div>
      </div>
    </footer>
  </div>

  <div id="modal" class="fixed inset-0 z-50 opacity-0 invisible transition-all duration-300">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" id="modal-backdrop"></div>
    <div class="modal-sheet absolute bottom-0 left-0 right-0 max-h-[85vh] rounded-t-2xl overflow-hidden translate-y-full transition-transform duration-300 ease-out">
      <div class="modal-handle flex justify-center py-4 bg-bg-elevated cursor-grab" id="modal-handle">
        <div class="w-10 h-1 rounded-full bg-white/20"></div>
      </div>
      <button id="modal-close" class="absolute top-3 right-4 p-2 rounded-full bg-white/[0.05] hover:bg-white/[0.1] transition-colors z-10">
        <svg class="w-4 h-4 text-white/50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
      </button>
      <div class="modal-content px-6 pb-8 bg-bg-elevated overflow-y-auto overscroll-contain" style="max-height: calc(85vh - 56px);">
        <div class="flex items-start gap-4 mb-6 pt-2">
          <div class="icon-box-lg" id="modal-icon-box">
            <svg class="w-6 h-6" id="modal-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"></svg>
          </div>
          <div class="flex-1 min-w-0 space-y-3 pr-8">
            <h2 class="text-xl font-bold text-white leading-tight tracking-tight" id="modal-title"></h2>
            <div class="flex flex-wrap gap-1.5" id="modal-tags"></div>
          </div>
        </div>
        <div class="modal-body text-[15px] leading-relaxed" id="modal-body"></div>
        <div class="relative my-8">
          <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-white/[0.06]"></div></div>
          <div class="relative flex justify-center"><span class="px-4 bg-bg-elevated text-[10px] text-white/30 font-mono uppercase tracking-wider">Feedback</span></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <a href="#" id="wa-btn" class="btn btn--whatsapp group">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            <span class="font-medium text-sm">WhatsApp</span>
          </a>
          <a href="#" id="mail-btn" class="btn btn--mail group">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
            <span class="font-medium text-sm">E-Mail</span>
          </a>
        </div>
        <div class="h-6"></div>
      </div>
    </div>
  </div>

  <style is:global>
    * { -webkit-tap-highlight-color: transparent; }
    body { overscroll-behavior: none; }
    .tab { color: rgba(255,255,255,0.35); }
    .tab:hover { color: rgba(255,255,255,0.6); }
    .tab.active { color: rgba(255,255,255,0.95); }
    .tab.active .tab-bg { opacity: 1; }
    .card { position: relative; padding: 1rem; border-radius: 0.875rem; cursor: pointer; transition: all 0.2s ease; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04); }
    .card:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.08); }
    .card:active { transform: scale(0.98); }
    .card-glow { position: absolute; inset: -1px; border-radius: 0.875rem; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
    .card:hover .card-glow { opacity: 1; }
    .card-glow--violet { box-shadow: inset 0 0 0 1px rgba(167,139,250,0.15), 0 0 30px -10px rgba(167,139,250,0.2); }
    .card-glow--blue { box-shadow: inset 0 0 0 1px rgba(96,165,250,0.15), 0 0 30px -10px rgba(96,165,250,0.2); }
    .card-glow--cyan { box-shadow: inset 0 0 0 1px rgba(34,211,238,0.15), 0 0 30px -10px rgba(34,211,238,0.2); }
    .card-glow--emerald { box-shadow: inset 0 0 0 1px rgba(52,211,153,0.15), 0 0 30px -10px rgba(52,211,153,0.2); }
    .card-glow--amber { box-shadow: inset 0 0 0 1px rgba(251,191,36,0.15), 0 0 30px -10px rgba(251,191,36,0.2); }
    .card-glow--rose { box-shadow: inset 0 0 0 1px rgba(251,113,133,0.15), 0 0 30px -10px rgba(251,113,133,0.2); }
    .icon-box { flex-shrink: 0; width: 2.5rem; height: 2.5rem; border-radius: 0.625rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); }
    .icon-box--violet { color: #a78bfa; } .icon-box--blue { color: #60a5fa; } .icon-box--cyan { color: #22d3ee; } .icon-box--emerald { color: #34d399; } .icon-box--amber { color: #fbbf24; } .icon-box--rose { color: #fb7185; }
    .card:hover .icon-box--violet { background: rgba(167,139,250,0.1); border-color: rgba(167,139,250,0.2); }
    .card:hover .icon-box--blue { background: rgba(96,165,250,0.1); border-color: rgba(96,165,250,0.2); }
    .card:hover .icon-box--cyan { background: rgba(34,211,238,0.1); border-color: rgba(34,211,238,0.2); }
    .card:hover .icon-box--emerald { background: rgba(52,211,153,0.1); border-color: rgba(52,211,153,0.2); }
    .card:hover .icon-box--amber { background: rgba(251,191,36,0.1); border-color: rgba(251,191,36,0.2); }
    .card:hover .icon-box--rose { background: rgba(251,113,133,0.1); border-color: rgba(251,113,133,0.2); }
    .icon-box-lg { flex-shrink: 0; width: 3rem; height: 3rem; border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); }
    .tag { display: inline-flex; align-items: center; padding: 0.2rem 0.5rem; border-radius: 0.375rem; font-size: 9px; font-weight: 500; }
    .tag--phase { background: rgba(255,255,255,0.04); color: rgba(255,255,255,0.5); border: 1px solid rgba(255,255,255,0.06); }
    .tag--default { background: transparent; color: rgba(255,255,255,0.35); }
    .btn { display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.875rem 1rem; border-radius: 0.625rem; transition: all 0.2s ease; }
    .btn--whatsapp { background: rgba(37,211,102,0.1); border: 1px solid rgba(37,211,102,0.2); color: #25D366; }
    .btn--whatsapp:hover { background: rgba(37,211,102,0.15); border-color: rgba(37,211,102,0.3); }
    .btn--mail { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); color: rgba(255,255,255,0.6); }
    .btn--mail:hover { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1); color: rgba(255,255,255,0.9); }
    #modal.open { opacity: 1; visibility: visible; }
    #modal.open .modal-sheet { transform: translateY(0); }
    .modal-content { -webkit-overflow-scrolling: touch; }
    .modal-body h2 { margin-top: 1.5rem; margin-bottom: 0.75rem; }
    .modal-body h3 { margin-top: 1.25rem; margin-bottom: 0.5rem; }
    .modal-body h4 { margin-top: 1rem; margin-bottom: 0.375rem; }
    .modal-body p { margin-bottom: 0.75rem; }
    .modal-body ul { margin-bottom: 1rem; }
    .animate-fade-in { opacity: 0; animation: fadeIn 0.5s ease-out forwards; }
    .animate-slide-up { opacity: 0; animation: slideUp 0.4s cubic-bezier(0.16,1,0.3,1) forwards; }
    @keyframes fadeIn { to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .icon-box-lg.violet { color: #a78bfa; background: rgba(167,139,250,0.1); border-color: rgba(167,139,250,0.2); }
    .icon-box-lg.blue { color: #60a5fa; background: rgba(96,165,250,0.1); border-color: rgba(96,165,250,0.2); }
    .icon-box-lg.cyan { color: #22d3ee; background: rgba(34,211,238,0.1); border-color: rgba(34,211,238,0.2); }
    .icon-box-lg.emerald { color: #34d399; background: rgba(52,211,153,0.1); border-color: rgba(52,211,153,0.2); }
    .icon-box-lg.amber { color: #fbbf24; background: rgba(251,191,36,0.1); border-color: rgba(251,191,36,0.2); }
    .icon-box-lg.rose { color: #fb7185; background: rgba(251,113,133,0.1); border-color: rgba(251,113,133,0.2); }
  </style>

  <script define:vars={{ features, WHATSAPP, EMAIL, icons }}>
    const modal = document.getElementById('modal');
    const modalContent = document.querySelector('.modal-content');
    const modalHandle = document.getElementById('modal-handle');
    const cardsContainer = document.getElementById('cards');
    const emptyState = document.getElementById('empty-state');
    const tabs = document.querySelectorAll('.tab');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        renderCards(tab.dataset.tab);
      });
    });

    function renderCards(status) {
      const filtered = features.filter(f => f.status === status);
      if (filtered.length === 0) { cardsContainer.innerHTML = ''; emptyState.classList.remove('hidden'); return; }
      emptyState.classList.add('hidden');
      cardsContainer.innerHTML = filtered.map((f, i) => `
        <article data-status="${f.status}" data-feature='${JSON.stringify(f).replace(/'/g, "&#39;")}' class="card-wrapper animate-slide-up" style="animation-delay: ${i * 60}ms;">
          <div class="card card--${f.color} group" data-id="${f.id}">
            <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-white/[0.08] to-transparent"></div>
            <div class="flex items-start gap-4">
              <div class="icon-box icon-box--${f.color}"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">${icons[f.icon] || icons['star']}</svg></div>
              <div class="flex-1 min-w-0 space-y-2">
                <h3 class="text-[15px] font-semibold text-white/90 leading-snug tracking-tight pr-6">${f.name}</h3>
                <div class="flex flex-wrap items-center gap-1.5">
                  <span class="tag tag--phase font-mono uppercase tracking-wider">${f.phase}</span>
                  ${f.tags.slice(0, 2).map(t => `<span class="tag tag--default">${t}</span>`).join('')}
                </div>
              </div>
              <div class="flex-shrink-0 self-center"><svg class="w-4 h-4 text-white/20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${icons['chevron-right']}</svg></div>
            </div>
            <div class="card-glow card-glow--${f.color}"></div>
          </div>
        </article>
      `).join('');
      attachCardListeners();
    }

    function attachCardListeners() {
      document.querySelectorAll('.card-wrapper').forEach(wrapper => {
        wrapper.addEventListener('click', () => {
          const f = JSON.parse(wrapper.dataset.feature.replace(/&#39;/g, "'"));
          openModal(f);
        });
      });
    }

    function openModal(f) {
      document.getElementById('modal-icon-box').className = 'icon-box-lg ' + f.color;
      document.getElementById('modal-icon').innerHTML = icons[f.icon] || icons['star'];
      document.getElementById('modal-title').textContent = f.name;
      document.getElementById('modal-tags').innerHTML = `<span class="tag tag--phase font-mono uppercase tracking-wider">${f.phase}</span>` + f.tags.map(t => `<span class="tag tag--default">${t}</span>`).join('');
      document.getElementById('modal-body').innerHTML = f.descriptionHtml;
      const enc = encodeURIComponent('Feedback: ' + f.name);
      document.getElementById('wa-btn').href = 'https://wa.me/' + WHATSAPP + '?text=' + enc;
      document.getElementById('mail-btn').href = 'mailto:' + EMAIL + '?subject=' + enc;
      modalContent.scrollTop = 0;
      modal.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() { modal.classList.remove('open'); document.body.style.overflow = ''; }

    document.getElementById('modal-backdrop').addEventListener('click', closeModal);
    document.getElementById('modal-close').addEventListener('click', closeModal);
    document.addEventListener('keydown', e => e.key === 'Escape' && closeModal());

    let startY = 0, currentY = 0, isDragging = false;
    const sheet = document.querySelector('.modal-sheet');
    modalHandle.addEventListener('touchstart', e => { startY = e.touches[0].clientY; isDragging = true; }, { passive: true });
    modalHandle.addEventListener('touchmove', e => { if (!isDragging) return; currentY = e.touches[0].clientY; const diff = currentY - startY; if (diff > 0) sheet.style.transform = 'translateY(' + diff + 'px)'; }, { passive: true });
    modalHandle.addEventListener('touchend', () => { if (!isDragging) return; isDragging = false; const diff = currentY - startY; sheet.style.transform = ''; if (diff > 100) closeModal(); }, { passive: true });

    attachCardListeners();
  </script>
</body>
</html>